apiVersion: batch/v1
kind: Job
metadata:
  name: quay-provisioner
  annotations:
    checksum/pipelines: "{{ include (print $.Template.BasePath \"/pipelines-configmap.yaml\") . | sha256sum }}"
spec:
  template:
    spec:
      serviceAccountName: quay-provisioner
      restartPolicy: Never
      containers:
        - name: provisioner
          image: busybox:latest
          command: ["sh", "-c"]
          args: ["echo 'Job l√§uft erfolgreich' && sleep 300"]
          env:
            - name: QUAY_API_BASE_URL
              valueFrom:
                secretKeyRef:
                  name: quay-config
                  key: QUAY_API_BASE_URL
            - name: QUAY_API_TOKEN
              valueFrom:
                secretKeyRef:
                  name: quay-config
                  key: QUAY_API_TOKEN
          volumeMounts:
            - name: pipelines
              mountPath: /app/src/pipelines
      volumes:
        - name: pipelines
          configMap:
            name: quay-provisioner-pipelines